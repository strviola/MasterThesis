\documentclass[a4paper,11pt]{jsarticle}
\title{Webアプリケーションにおける不正行為の統計的検出}
\author{12M38278 鈴木竜太}
\date{\today}

% packages
\usepackage[dvipdfm]{graphicx}
\usepackage{listings}
\usepackage{ascmac}
\usepackage{here}
\usepackage{txfonts}

% environment
\newtheorem{pydef}{定義}

% definition
\newcommand{\savefunc}{{\tt save\_to\_outer}}
\newcommand{\param}{\paragraph{パラメータ}}


\begin{document}
%\maketitle
%%%%%%%%いつもここから%%%%%%%%

\tableofcontents

\newpage

%%%%%%%%%%%%%%% はじめに %%%%%%%%%%%%%%%
\part{はじめに}
\section{背景}
\subsection{不正行為の検出}
ネットワークを用いたアプリケーションは広くアクセス可能であるという利点がある反面，しばしば脆弱性を悪用した攻撃の対象になりうる．
Webアプリケーションの利用の一つとしてオンラインゲームが存在するが，これも攻撃の対象として例外ではない．
オンラインゲームにおける不正行為は特にチートと呼ばれ，チート検出に関して数多くの既存研究が存在する．
過去のチート検出に関する研究は，以下の条件を前提としていた．

\begin{enumerate}
\item
\label{all_server}プレイヤーの全ての入力がサーバーに送信される．
\item
チート検出機構は，サーバーへの全ての入力を検出材料として利用できる．
\end{enumerate}

この論文では，前提\ref{all_server}を「常時接続」，常時接続なゲームのもとで行われるチートを，\cite{gamefps}に倣って「仮想ドーピング」と呼ぶ．

\subsection{一時接続ゲーム}
近年，ゲーム上の入力の全てではなく，その中の一部だけ，もしくはそれを加工したデータをサーバーに送信する設計のオンラインゲームが普及しつつある．
本論文ではこの特徴を「一時接続」と呼ぶ．
一時接続ゲームは以下の理由から，特に携帯端末プラットフォームにおいて顕著である．

\begin{itemize}
\item
消費電力を抑える．携帯端末はバッテリーが有限であり，さらにゲーム以外のアプリケーションにも影響するため．
\item
屋外での利用も想定すると，電波環境が安定しない．
\end{itemize}

一時接続ゲームにもチートは存在しうる．より一般的に，以下の条件を満たすサーバー・クライアント型アプリケーションにはチートが発生する．

\begin{enumerate}
\item
サーバーにデータを送信し，他の人(アカウント)と共有する
\item
クライアントの設計上、送信データに「制約」が存在する
\item
制約外のデータ(「チート」と呼ぶ)を送信することで、他人の行動や意思決定に影響する
\item
チートを行うことで自分に有利になる
\end{enumerate}

ここで，この条件が妥当である理由を，具体例を交えて説明する．
まず1は最大の前提である．
そもそもインターネットに繋がっていないゲームであれば，たとえ改造者がクライアントを改造するなどしてプレイヤーに不正に有利な状態を作ったとしても何ら問題はない．
それは改造者が勝手に遊んでいるだけで，他人に迷惑をかけていない(もちろん，二次創作物やそれに対する著作権などの問題が発生することが考えられるが，今回の研究の興味の対象ではない)．
また2に関して，「制約」が存在する全てのアプリケーションでチートが問題になるとは限らない．
例えばTwitterは「140文字以上の文字列を送信できない」という「制約」が存在するが，この制約を守らないチート的な送信があったところでそれは他人に何ら影響はない．

問題は3の「他人に影響する」という特徴である．
オンラインゲームは遠い所にいる他人との同時プレイを可能にするものであり，それが醍醐味のひとつでもある．
一方でそれを可能にしている技術には欠陥が含まれることも多く，チートを許してしまうケースも存在する．
例えば，ガンホー社の「パズル\&ドラゴンズ」(パズドラ)では，外部ツール\cite{ghostrouter}を利用してゲーム内のデータを任意の数値に書き換えるチートが可能である．
このチートを行った時，プレイヤー本人が有利な状態を不正に作る\footnote{強力なキャラクターを使用できる，既存のキャラクターの能力を向上させる，などが可能である．}だけでなく，他人の意思決定に影響してゲーム内ポイントをより多く獲得することも期待できる．

\section{問題点}
\subsection{仮想強盗}
一時接続ゲームにおけるチートの多くは，様々なパラメータを偽り，悪意のあるプレイヤーに有利な状態を作ることを目的とする．
この操作は，ゲーム内のプロセスを経ることなく，キャラクターやアイテムを使用可能にし，またキャラクターの性能を上げるなどの効果をもたらす．
本論文ではこのチートに注目し，常時接続ゲームにおける「仮想ドーピング」と対比して「仮想強盗」と呼ぶ．
既存の仮想ドーピングチート検出システムは，仮想強盗を検出できるかどうか自明ではない．これは以下の特徴の違いによる．

\begin{center}
\begin{tabular}{l|cc}
& 仮想強盗 & 仮想ドーピング \\ \hline
情報の性質 & データ & 行動 \\
アクセス密度 & 低 & 高 \\
攻撃一般化 & なし & あり \\
\end{tabular}
\end{center}

ただし，

\begin{itemize}
\item
アクセス密度: 1アクセス元の単位時間あたりのアクセス回数．
\item
攻撃一般化: 観測対象の攻撃が事前に知られているか
\end{itemize}

常時接続ゲームでは，サーバーへの入力がそのままゲーム内の行動を表す．このため，単位時間あたりの移動距離や操作回数など，比較的単純な指標でチートを検出できる\cite{botcraft}．それに対し一時接続ゲームでは，チート判定に利用できる情報の質・量共に限られるため，短時間的な入力のみで判定できるとは限らない．

\section{目的}
本研究では，一時接続ゲームにおける仮想強盗の検出を目的とする．

\newpage % \partの直前固定

%%%%%%%%%%%%%%% 方法 %%%%%%%%%%%%%%%

\part{方法}
この部では，今回の実験の対象としたゲーム「ちくわ栽培キット」と，「ちくわ」におけるチートおよびそれの検出方法について述べる．

\section{ちくわ栽培キット}
\subsection{概要}
「ちくわ栽培キット」は，「ちくわ」をメインキャラクターとした育成シミュレーションゲームである．このゲームは「育成」「設備投資」「バトル」「図鑑」の要素からなる．

\subsubsection{用語の解説}
\paragraph{ちくわ}
ゲーム中で取得可能なキャラクターである．このゲームは「ちくわ」を収集することを最大の目的とする．60種類\footnote{2014年1月現在．今後増える可能性がある．}存在し，それぞれ特徴が異なる．取得したちくわは一時的に「収穫箱」に保存される．

\paragraph{収穫箱}
取得したちくわを保存する機能．収穫箱に存在するちくわに対して，さらに操作が可能である．

\paragraph{ちくわポイント(TP)}
ゲーム内通貨．

\subsubsection{操作の説明}
\paragraph{栽培・収穫}
ちくわを生成する．出現したちくわは「収穫」することで収穫箱に保存される．

\paragraph{売却}
収穫箱にあるちくわを，ちくわごとに定義されたTPと交換する．

\paragraph{設備投資}
TPを消費し，発生するちくわの種類を含む栽培に関するパラメータを変更(向上)できる．

\paragraph{バトル}
他人と対戦する．その際，以下の手続きを経る．

\begin{enumerate}
\item
「対戦」コマンドを選択する．この際サーバーとの通信が発生し，収穫箱にあるちくわの種類(ID: 整数)と数(整数)が全て送信される．
\item
プレイヤーは自分が操作するちくわを選択する．「自軍」と呼ぶ．
\item
サーバーに保存されているちくわのリスト(所持者のユーザーID，ちくわID，ちくわの数)から一部を取得する．
\item
プレイヤーはリストから対戦相手とするちくわを選択する．「敵軍」と呼ぶ．
\item
バトルが開始する．プレイヤーは一定時間以内画面をタップすれば勝ち，出来なければ負けである．その時間は自軍と敵軍のパラメータから計算される．
\item
勝敗に応じてイベントが発生する．
\begin{itemize}
\item
プレイヤーが勝った場合，敵軍のちくわのコピーがプレイヤーの収穫箱に追加される．この時，敵軍のちくわIDと数がサーバーに送信される．
\item
プレイヤーが負けた場合，自軍のちくわが収穫箱から削除される．この時，敵軍のちくわの所持者に報酬が送信される．報酬は敵軍のちくわの売却TPと同一である．
\end{itemize}
\end{enumerate}


\subsection{実装}
\subsubsection{クライアントサイド}
クライアントサイドの実装はAndroidで行った．バトル機能を利用する際にHTTP通信を利用する．

\subsubsection{サーバーサイド}
サーバーサイドの実装にはDjango\cite{django}を用いた．DjangoはPython\cite{python}で実装されたWebアプリケーションフレームワークである．Djangoを用いたWebアプリケーション開発では，以下の要素を定義する必要がある\footnote{クライアントがWebアプリケーションである場合，この他にテンプレートHTMLを定義する．今回の「ちくわ栽培キット」では利用していない．}．

\begin{itemize}
\item
モデル．データベースに登録するクラスである．
\item
ビュー関数．リクエストオブジェクトを受け取り，データベースを利用した操作を行い，レスポンスオブジェクトを返す．
\item
URLディスパッチャ．URLとビュー関数を対応づける．
\end{itemize}

\subsection{このゲームで考えられる仮想強盗}
\paragraph{過剰ちくわID}
ゲームの進行状態によって，取得可能なちくわIDには制限が存在する．制限を解放するには，設備投資を行って発生ちくわIDの上限を上げる必要がある．しかし，不正アクセスにより制限外のIDをサーバーに送信することが可能である．

\paragraph{過剰ちくわ数}
収穫箱の容量には上限が存在する\footnote{2014年1月現在，この上限は200で固定である．ゲームに課金することでこの上限を拡張する機能を実装予定である．}．従ってサーバーに送信される「ちくわ数」にも制限が存在する．しかし，ここで不正アクセスにより極端に多いちくわ数を送信することも可能である．

\paragraph{過剰報酬}
プレイヤーがバトルに負けた場合，敵軍の所持者に報酬としてTPが送信される．この報酬TPは敵軍のちくわのIDと数によって決まる．しかし，不正アクセスを行うと任意の数を送信することが可能である．

\section{提案手法}
この節では，仮想強盗の検出に関わる手法を述べる．

\subsection{ログの取得}
Djangoのビュー関数はHTTPリクエストオブジェクトを受け取り，リクエストからパラメータを取り出したあと，データベース処理などを行ってレスポンスを返す．
しかし，最初のリクエストオブジェクト自体は破棄される．
一方，Apache ServerにはCommon Log Format\cite{clf} (CLF) 形式でログを保存する機能が存在する．
しかし，CLFでアクセス元を区別する方法はIPアドレスのみであり，アクセス元に付随するアプリケーション上の情報は取得できない．
従って，この情報ではチートの検出に不十分である．

本研究では，PythonのPickleモジュール\cite{pickle}を用い，リクエストオブジェクトを直接外部ファイルに保存する手法をとった．
以後，保存されたリクエストオブジェクトを「ログ配列」，ログ配列が保存されている外部ファイルを「ログファイル」と呼ぶ．
リクエストオブジェクトには以下の情報が含まれる．

\begin{itemize}
\item
ユーザープロフィール．
\begin{itemize}
\item
ユーザーID(Primary Key, PK)．会員登録時にサーバーが自動的に付与する．
\item
メールアドレス．
\item
表示名．
\item
最終ログイン日時．
\item
会員登録日時．
\end{itemize}
\item
リクエストパラメタ．Pythonの辞書(Dictionary)形式．
\end{itemize}

\paragraph{ログ配列へのリクエストオブジェクトの追加}
リクエストオブジェクトを外部ファイルに保存するためのメソッドを \savefunc として定義した．この定義は以下の通りである．

\begin{pydef}
\savefunc{\tt (request, filename)}

予め保存されているログファイルを開き(これに失敗した場合は新規作成)，リクエストオブジェクトを付けたし，絵歌度ログファイルに保存する．

\param
\begin{itemize}
\item
{\tt request} 保存するリクエストオブジェクト．
\item
{\tt filename} ログファイルのファイル名．
\end{itemize}

\end{pydef}



この外部ファイルは``unpickle''を適用することでPythonインスタンスとして扱うことができる．



\subsection{ログから座標への変換}

\subsection{仮想強盗の検出}

\newpage
\part{実験}
\section{実験環境}
\section{結果}

\newpage
\part{議論}

\newpage
\part{おわりに}
\section{まとめ}
\section{貢献}
\section{今後の課題}

\newpage
\part*{謝辞}



\newpage
\begin{thebibliography}{99}

\bibitem{mining}
Lee, Wenke, Salvatore J. Stolfo, and Kui W. Mok. "A data mining framework for building intrusion detection models." Security and Privacy, 1999. Proceedings of the 1999 IEEE Symposium on. IEEE, 1999.

\bibitem{ripper}
Cohen, William W. "Fast effective rule induction." ICML. Vol. 95. 1995.

\bibitem{cluster}
Portnoy, Leonid, Eleazar Eskin, and Sal Stolfo. "Intrusion detection with unlabeled data using clustering." In Proceedings of ACM CSS Workshop on Data Mining Applied to Security (DMSA-2001. 2001.

\bibitem{httplearn}
Kruegel, Christopher, Giovanni Vigna, and William Robertson. "A multi-model approach to the detection of web-based attacks." Computer Networks 48.5 (2005): 717-738.

\bibitem{botcraft}
Gianvecchio, Steven, et al. "Battle of Botcraft: fighting bots in online games with human observational proofs." Proceedings of the 16th ACM conference on Computer and communications security. ACM, 2009.

\bibitem{gamep2p}
Xiang-bin, Shi, et al. "A cheating detection mechanism based on fuzzy reputation management of P2P MMOGs." Software Engineering, Artificial Intelligence, Networking, and Parallel/Distributed Computing, 2007. SNPD 2007. Eighth ACIS International Conference on. Vol. 2. IEEE, 2007.

\bibitem{gamefps}
Laurens, Peter, et al. "A novel approach to the detection of cheating in multiplayer online games." Engineering Complex Computer Systems, 2007. 12th IEEE International Conference on. IEEE, 2007.

\bibitem{ghostrouter}
GHOSTROUTER. http://www.internal.co.jp/products/util/ghostrouter/about/

\bibitem{django}
Django project. https://www.djangoproject.com

\bibitem{python}
Python programming language. http://www.python.org

\bibitem{clf}
Log format. Apache. http://httpd.apache.org/docs/2.4/mod/mod\_log\_config.html

\bibitem{pickle}
Pickle. Python. http://docs.python.jp/2/library/pickle.html

\end{thebibliography}

%\bibliographystyle{jplain}
%\bibliography{cite}

\end{document}










